{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <h3 class="text-center">Register</h3>
        <div class="card">
            <div class="card-body">
                <form id="registerForm" method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" class="form-control" id="username" name="username" placeholder="Enter username" required>
                    </div>
                    <div class="form-group">
                        <label for="firstname">First Name</label>
                        <input type="text" class="form-control" id="firstname" name="firstname" placeholder="Enter firstname" required>
                    </div>
                    <div class="form-group">
                        <label for="lastname">Last Name</label>
                        <input type="text" class="form-control" id="lastname" name="lastname" placeholder="Enter lastname" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email address</label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="Enter email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" class="form-control" id="password" name="password" placeholder="Password" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block">Register</button>
                </form>
                <p id="registerMessage" class="mt-3 text-center"></p>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('registerForm').onsubmit = async function(e){
    e.preventDefault();

    const formData = new FormData(this);
    const data = {
        username: formData.get('username'),
        email: formData.get('email'),
        password: formData.get('password'),
        first_name: formData.get('firstname'),
        last_name: formData.get('lastname')
    };

    const res = await fetch("{% url 'api_register' %}", {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });

    const result = await res.json();
    const messageEl = document.getElementById('registerMessage');

    if (res.ok) {
        messageEl.classList.add('text-success');
        messageEl.innerText = result.message || 'Registration successful! Redirecting to login...';

        // âœ… Redirect to login page after 2 seconds
        setTimeout(() => {
            window.location.href = "{% url 'login_page' %}";
        }, 2000);
    } else {
        messageEl.classList.add('text-danger');
        messageEl.innerText = result.error || 'Registration failed. Please try again.';
    }
};
</script>

{% endblock %}
